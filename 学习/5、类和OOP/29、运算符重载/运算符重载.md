# 第29章 运算符重载

## 基础知识

运算符重载：在类方法中**拦截**内置操作

* 运算符重载可以让类拦截常规的 Python 运算
* 类可以重载所有的 Python 表达式运算符
* 类也可以重载打印、函数调用、属性点号运算等内置运算
* 重载使类实例的行为像内置类型
* 重载是通过提供特殊名称的类方法来实现的

## 常见的运算符重载方法

常见的运算符重载方法

|                            方法                            |          重载          |                               调用                              |
|------------------------------------------------------------|------------------------|-----------------------------------------------------------------|
| `__init__`                                                 | 构造函数               | 对象建立：`X = Class(args)`                                     |
| `__del__`                                                  | 析构函数               | 对象收回（删除）                                                |
| `__add__`                                                  | 运算符 `+`             | 如果没有 `_iadd_` 时，`X + Y` `X += Y`                          |
| `__sub__`                                                  | 运算符 `-`             |                                                                 |
| `__mul__`                                                  | 运算符 `*`             |                                                                 |
| `__div__`                                                  | 运算符 `/`             |                                                                 |
| `__or__`                                                   | 运算符 `/`（位or）     | 如果没有 `_ior_` 时，`X / Y` `X /= Y`                           |
| `__repr__`, `__str`                                        | 打印，转换             | `print(x)`, `repr(x)`, `str(x)`                                 |
| `__call__`                                                 | 函数调用               | `X(*args, **kargs)`                                             |
| `__getattr__`                                              | 点号运算               | `X.undefined`                                                   |
| `__setattr__`                                              | 属性赋值语句           | `X.any = value`                                                 |
| `__delattr__`                                              | 属性删除               | `del X.any`                                                     |
| `__getattribute__`                                         | 属性获取               | `X.any`                                                         |
| `__getitem__`                                              | 索引运算               | `X[key]`, `X[i:j]`，没有 `__iter__` 时的 `for` 循环和其他迭代器 |
| `__setitem__`                                              | 索引赋值语句           | `X[key] = value`, `X[i:j] = sequence`                           |
| `__delitem__`                                              | 索引和分片删除         | `del X[key]`, `del X[i:j]`                                      |
| `__len__`                                                  | 长度                   | `len(X)`，如果没有 `__bool__`，真值测试                         |
| `__bool__`                                                 | 布尔测试               | `bool(X)`，真测试                                               |
| `__lt__`, `__gt__`, `__le__`, `__ge__`, `__eq__`, `__ne__` | 特定的比较             | `x < y`, `x > y`, `x <= y`, `x >= y`, `x == y`, `x != y`        |
| `__radd__`                                                 | 右侧加法               | `other + X`                                                     |
| `__iadd__`                                                 | 实地（增强的）加法     | `X += Y`，如果没定义 `__iadd__`，使用 `__add__`                 |
| `__iter__`, `__next__`                                     | 迭代环境               | `I = iter(X)`, `next(I)`, `for` 循环，`map(func, X)` 等         |
| `__contains__`                                             | 成员关系测试           | `item in X` X为任何可迭代对象                                   |
| `__index__`                                                | 整数值                 | `hex(X)`, `bin(X)`, `oct(X)`, `O[X]`, `O[X: ]`                  |
| `__enter__`, `__exit__`                                    | 环境管理器（详见33章） | `with obj as var: pass`                                         |
| `__get__`, `__set__`, `__delete__`                         | 描述符属性（详见37章） | `X.attr`, `X.attr = value`, `del X.attr`                        |
| `__new__`                                                  | 创建（详见39章）       | 在 `__init__` 之前创建对象                                      |

## 构造函数和表达式：\_\_init__ 和 \_\_sub__

`__init__`
: 出现在绝大多数类中，是最常见的运算符重载方法

`__add__`, `__sub__`, `__mul__`, `__div__`
: 对加减乘除表达式进行运算符重载，可以使类实现加减乘除

## 索引和分片：\_\_getitem__ 和 \_\_setitem__


